\textbf{Problem 2b: Toffoli gate decomposition}. Starting from the initial 3-qubit state $\ket{111}$ (ordering: top-middle-lower), and staying in ket
notation, trace through each step of the circuit to verify the output produced.


\textbf{Answer}. The circuit commences with quantum state ${\ket{\psi}_0} = \ket{1} \otimes \ket{1} \otimes \ket{1}$. 
Step 1: apply a Hadamard gate to the third qubit
\begin{align*}
	\ket{\psi_{1}} &= H_{3} \ket{\psi_{0}} \\
	&= \ket{1} \otimes \ket{1} \otimes \ket{-}
\end{align*}

Step 2: apply a CNOT gate with the second qubit as the control, and the third qubit as the target
\begin{align*}
	\ket{\psi_{2}} &= CNOT_{2,3} \ket{\psi_{1}} \\
	&= \ket{1} \otimes \ket{1} \otimes -\ket{-} 
\end{align*}

Step 3: apply a $T^\dag$ gate to qubit 3
\begin{align*}
	\ket{\psi_{3}} &= T_{3}^\dag \ket{\psi_{2}} \\ 
	&= \ket{1} \otimes \ket{1} \otimes -\frac{1}{\sqrt{2}}(\ket{0} - e^{-i\pi/4}\ket{1}) \\
\end{align*}

Step 4: apply a CNOT gate with the first qubit as the control, and the third qubit as the target
\begin{align*}
	\ket{\psi_{4}} &= CNOT_{1,3} \ket{\psi_{3}} \\
	&= \ket{1} \otimes \ket{1} \otimes \frac{1}{\sqrt{2}}(e^{-i\pi/4}\ket{0} - \ket{1}) 
\end{align*}

Step 5: apply a $T$ gate to qubit 3
\begin{align*}
	\ket{\psi_{5}} &= T_3 \ket{\psi_{4}} \\
	&= \ket{1} \otimes \ket{1} \otimes \frac{1}{\sqrt{2}}(e^{-i\pi/4}\ket{0} - e^{i\pi/4}\ket{1})
\end{align*}

Step 6: apply a CNOT gate with the second qubit as the control, and the third qubit as the target
\begin{align*}
	\ket{\psi_{6}} &= CNOT_{2,3} \ket{\psi_{5}} \\
	&= \ket{1} \otimes \ket{1} \otimes -\frac{1}{\sqrt{2}}(e^{i\pi/4}\ket{0} - e^{-i\pi/4}\ket{1})
\end{align*}

Step 7: apply a $T^\dag$ gate to qubit 3
\begin{align*}
	\ket{\psi_{7}} &= T_{3}^\dag \ket{\psi_{6}} \\
	&= \ket{1} \otimes \ket{1} \otimes -\frac{1}{\sqrt{2}}(e^{i\pi/4}\ket{0} - e^{-i\pi/2}\ket{1})
\end{align*}

Step 8: apply a CNOT gate with the first qubit as the control, and the third qubit as the target
\begin{align*}
	\ket{\psi_{8}} &= CNOT_{1,3} \ket{\psi_{7}} \\
	&= \ket{1} \otimes \ket{1} \otimes \frac{1}{\sqrt{2}}(e^{-i\pi/2}\ket{0} - e^{i\pi/4}\ket{1})
\end{align*}

Step 9: apply $T$ gates to qubits 2 and 3
\begin{align*}
	\ket{\psi_{9}} &= T_2 T_3 \ket{\psi_{8}} \\
	&= \ket{1} \otimes e^{i\pi/4}\ket{1} \otimes \frac{1}{\sqrt{2}}(e^{-i\pi/2}\ket{0} - e^{i\pi/2}\ket{1}) \\
	&= \ket{1} \otimes e^{i\pi/4}\ket{1} \otimes \frac{e^{-i\pi/2}}{\sqrt{2}}(\ket{0} - e^{i\pi}\ket{1})\\
	&= \ket{1} \otimes e^{i\pi/4}\ket{1} \otimes e^{-i\pi/2}\ket{+}
\end{align*}

Step 10: apply a CNOT gate with the first qubit as the control, and the second qubit as the target, and apply a Hadamard gate to qubit 3
\begin{align*}
	\ket{\psi_{10}} &= CNOT_{1,2} H_3 \ket{\psi_{9}} \\
	&= \ket{1} \otimes e^{i\pi/4}\ket{0} \otimes e^{-i\pi/2}\ket{0}
\end{align*}

Step 11: apply a $T$ gate to qubit 1, and a $T^\dag$ gate to qubit 2
\begin{align*}
	\ket{\psi_{11}} &= T_1 T^\dag_2 \ket{\psi_{10}} \\
	& = e^{i\pi/4}\ket{1} \otimes e^{i\pi/4}\ket{0} \otimes e^{-i\pi/2}\ket{0}
\end{align*}

Step 12: apply a CNOT gate with the first qubit as the control, and the second qubit as the target
\begin{align*}
	\ket{\psi_{12}} &= CNOT_{1,2} \ket{\psi_{11}} \\
	&= e^{i\pi/4}\ket{1} \otimes e^{i\pi/4}\ket{1} \otimes e^{-i\pi/2}\ket{0}\\
	&= e^{i\pi/4}e^{i\pi/4}e^{-i\pi/2}\ket{110} \\
	&= \ket{110} 
\end{align*}

% \begin{align*}
% 	\ket{\psi_{0}} &= \ket{1} \otimes \ket{1} \otimes \ket{1} \\
% 	\ket{\psi_{1}} &= H_{3} \ket{\psi_{0}} = \ket{1} \otimes \ket{1} \otimes \ket{-} \\
% 	\ket{\psi_{2}} &= CNOT_{2,3} \ket{\psi_{1}} = \ket{1} \otimes \ket{1} \otimes -\ket{-} \\
% 	\ket{\psi_{3}} &= T_{3}^\dag \ket{\psi_{2}} = \ket{1} \otimes \ket{1} \otimes -\frac{1}{\sqrt{2}}(\ket{0} - e^{-i\pi/4}\ket{1}) \\
% 	\ket{\psi_{4}} &= CNOT_{1,3} \ket{\psi_{3}} = \ket{1} \otimes \ket{1} \otimes \frac{1}{\sqrt{2}}(e^{-i\pi/4}\ket{0} - \ket{1}) \\
% 	\ket{\psi_{5}} &= T_3 \ket{\psi_{4}} = \ket{1} \otimes \ket{1} \otimes \frac{1}{\sqrt{2}}(e^{-i\pi/4}\ket{0} - e^{i\pi/4}\ket{1})\\
% 	\ket{\psi_{6}} &= CNOT_{2,3} \ket{\psi_{5}} = \ket{1} \otimes \ket{1} \otimes -\frac{1}{\sqrt{2}}(e^{i\pi/4}\ket{0} - e^{-i\pi/4}\ket{1})\\
% 	\ket{\psi_{7}} &= T_{3}^\dag \ket{\psi_{6}} = \ket{1} \otimes \ket{1} \otimes -\frac{1}{\sqrt{2}}(e^{i\pi/4}\ket{0} - e^{-i\pi/2}\ket{1})\\
% 	\ket{\psi_{8}} &= CNOT_{1,3} \ket{\psi_{7}} = \ket{1} \otimes \ket{1} \otimes \frac{1}{\sqrt{2}}(e^{-i\pi/2}\ket{0} - e^{i\pi/4}\ket{1})\\
% 	\ket{\psi_{9}} &= T_2 T_3 \ket{\psi_{8}} = \ket{1} \otimes e^{i\pi/4}\ket{1} \otimes \frac{1}{\sqrt{2}}(e^{-i\pi/2}\ket{0} - e^{i\pi/2}\ket{1})\\
% 	&= \ket{1} \otimes e^{i\pi/4}\ket{1} \otimes \frac{e^{-i\pi/2}}{\sqrt{2}}(\ket{0} - e^{i\pi}\ket{1})\\
% 	&= \ket{1} \otimes e^{i\pi/4}\ket{1} \otimes e^{-i\pi/2}\ket{+}\\
% 	\ket{\psi_{10}} &= CNOT_{1,2} H_3 \ket{\psi_{9}} = \ket{1} \otimes e^{i\pi/4}\ket{0} \otimes e^{-i\pi/2}\ket{0}\\
% 	\ket{\psi_{12}} &= CNOT_{1,2} \ket{\psi_{11}} = e^{i\pi/4}\ket{1} \otimes e^{i\pi/4}\ket{1} \otimes e^{-i\pi/2}\ket{0}\\
% \end{align*}

